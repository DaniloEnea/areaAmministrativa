<div class="loading-overlay" *ngIf="LoadedData===false">
  <mat-spinner *ngIf="LoadedData===false" mode="indeterminate"></mat-spinner>
</div>
<div class="card">
  <div class="card-body">
    <div style="text-align:center">
      <h1 class="card-title">Change Password</h1>
      <br />
      <h3 class="card-title">Set a password for start to use your account</h3>
      <br />
    </div>
    <div *ngIf="errorMessage && !changePasswordForm.hasError('mustMatch', 'confirm')" class="alert alert-danger" role="alert">
      <span [innerHTML]="errorMessage"></span>
    </div>

    <div *ngIf="showSuccess" class="alert alert-success" role="alert">
      <span [innerHTML]="successMessage"></span>
    </div>

    <form *ngIf="!errorMessage || changePasswordForm.hasError('mustMatch', 'confirm') || !showSuccess" [formGroup]="changePasswordForm" autocomplete="off" novalidate (ngSubmit)="changePassword(changePasswordForm.value)">
      <div class="mb-3 row">
        <mat-form-field class="col-md-5">
          <mat-label>Password</mat-label>
          <input matInput id="password" formControlName="password" [type]="hide1 ? 'password' : 'text'">
          <mat-icon matSuffix (click)="hide1 = !hide1">{{ visibilityIconPwd }}</mat-icon>
        </mat-form-field>
        <div class="col-md-5">
          <em *ngIf="validateControl('password') && hasError('password', 'required')" style="color:red">Password is required</em>
        </div>
      </div>

      <div class="mb-3 row">
        <mat-form-field class="col-md-5">
          <mat-label>Confirm Password</mat-label>
          <input matInput id="confirm" formControlName="confirm" [type]="hide2 ? 'password' : 'text'">
          <mat-icon matSuffix (click)="hide2 = !hide2">{{ visibilityIconCheckPwd }}</mat-icon>
        </mat-form-field>
        <div class="col-md-5">
          <em *ngIf="validateControl('confirm') && hasError('confirm', 'required')" style="color:red">Confirmation is required</em>
          <em *ngIf="changePasswordForm.get('confirm')?.hasError('mustMatch') && changePasswordForm.get('confirm')?.touched" style="color:red">Passwords must match</em>
        </div>
      </div>

      <div>
        <mat-checkbox formControlName="isGdprAccepted">
        </mat-checkbox>
          <span (click)="openGdprModale()" class="gdpr-link">I have read and accept the privacy policy</span>
        <em *ngIf="validateControl('isGdprAccepted') && hasError('isGdprAccepted', 'required')" style="color:red"><br />You must accept the privacy policy</em>
      </div>

      <div class="mb-3 row">
        <div class="col-md-1">
          <button type="submit" mat-raised-button color="primary" [disabled]="!changePasswordForm.valid || !changePasswordForm.value.isGdprAccepted || resetButtonDisabled === true">Submit</button>
        </div>
      </div>
    </form>

    <div *ngIf="errorMessage">
      <button mat-raised-button (click)="reload()" color="primary">Reload</button>
    </div>
  </div>
</div>
